{% extends 'base.html' %}

{% block title %}Unified Science Labs | Provider Results{% endblock %}

{% block head %}
<style>
    .card-header a {
        text-decoration: none;
        color: black;
        font-size: 18px;
    }

    #lab-name:hover {
        text-decoration: underline;
        color: black;
        cursor: pointer;
    }

    .hover-effect:hover {
        box-shadow: 0 4px 16px 0 rgba(93, 207, 255, 0.4);
        transform: scale(1.01);
        cursor: pointer;
    }

    .price-badge {
        color: rgb(0, 0, 0);
        background-color: #c0c1ff;
        padding: 5px;
        font-size: 14px;
        border-radius: 10px;
        margin-right: 10px;
    }

    .turnaround-badge {
        color: white;
        background-color: #8d8fff;
        padding: 5px;
        font-size: 14px;
        border-radius: 10px;
        margin-right: 10px;
    }

    .specialty-badge {
        color: white;
        background-color: #4744ff;
        padding: 5px;
        font-size: 14px;
        border-radius: 10px;
        margin-right: 10px;
    }
        
</style>

{% endblock %}

{% block content %}

{% set test_query_results = test_query_results %}

<div class="container pt-5 mt-5">
    <h1>Discover Top Labs Near You</h1>
    <br>
    <p>Explore our curated list of local laboratories ready to perform the <b>{{ test }}</b> test with accuracy and efficiency.</p>
    <p>All prices are <i>per sample</i>.</p>
</div>

<div class="container mb-5 pb-5">
    <section class="mb-3">
        <span class="mx-2">
            <strong>Sort by:</strong>
        </span>

        <span class="mx-2">
            <button type="button" class="btn btn-primary" id="price_sort_btn" 
                data-bs-toggle="modal" data-bs-target="#priceModal">Price</button>
        </span>

        <div class="modal fade" id="priceModal" tabindex="-1" aria-labelledby="priceModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">

                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="priceModalLabel">Sort by Price</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>

                    <div class="modal-body text-center">
                        <button type="button" class="btn btn-primary mx-2" id="price_high_to_low">High to Low</button>
                        <button type="button" class="btn btn-primary mx-2" id="price_low_to_high">Low to High</button>
                    </div>

                </div>
            </div>
        </div>

        <span class="mx-2">
            <button type="button" class="btn btn-primary" id="turnaround_sort_btn"
                data-bs-toggle="modal" data-bs-target="#turnaroundModal">Turnaround</button>
        </span>

        <div class="modal fade" id="turnaroundModal" tabindex="-1" aria-labelledby="turnaroundModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">

                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="turnaroundModalLabel">Sort by Turnaround</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>

                    <div class="modal-body text-center">
                        <button type="button" class="btn btn-primary mx-2" id="turnaround_high_to_low">High to Low</button>
                        <button type="button" class="btn btn-primary mx-2" id="turnaround_low_to_high">Low to High</button>
                    </div>

                </div>
            </div>
        </div>
    </section>

    <div id="lab_query_container">
        {% include 'lab_cards_partial.html' %}
    </div>
</div>

<form id="labForm" action="{{ url_for('views.lab_query', test=test, zipcode=zipcode) }}" method="POST" style="display: none;">
    <input type="hidden" name="lab_name" id="lab_name_input" value="">
    <input type="submit" class="btn btn-primary m-1" value="Choose Lab">
</form>

<script>
    function sortTable(sortType) {
        $.ajax({
            type: "GET",
            url: "/sort-lab-query/" + sortType,
            data: { sort_type: sortType,
                    test: '{{ test }}',
            },
            success: function (data) {            
                document.getElementById("lab_query_container").innerHTML = data;
                if ($('#priceModal').is(':visible') || $('#turnaroundModal').is(':visible')) {
                    $('#priceModal, #turnaroundModal').modal('hide');
                }
            },
        });
    }

    // Attach event listeners to the sorting buttons.
    const sortingTypes = ["price", "turnaround"];
    const sortingDirections = ["high_to_low", "low_to_high"];

    sortingTypes.forEach((type) => {
        sortingDirections.forEach((direction) => {
            const elementId = `${type}_${direction}`;
            const element = document.getElementById(elementId);
            if (element) {
                element.addEventListener("click", function () {
                    sortTable(elementId);
                });
            }
        });
    });

    /*
    document.getElementById("price_high_to_low").addEventListener("click", function () {
        sortTable("price_high_to_low");
    });

    document.getElementById("price_low_to_high").addEventListener("click", function () {
        sortTable("price_low_to_high");
    });

    document.getElementById("turnaround_high_to_low").addEventListener("click", function () {
        sortTable("turnaround_high_to_low");
    });

    document.getElementById("turnaround_low_to_high").addEventListener("click", function () {
        sortTable("turnaround_low_to_high");
    });*/

    function submitForm(labName) {
        document.getElementById('lab_name_input').value = labName;
        document.getElementById('labForm').submit();
    }
</script>


{% endblock %}